<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<!--
NOTES:
    * Panoramic images should be a power of 2 in width, because otherwise the
      tiles will have borders on the left and right edges. Height doesn't
      matter (we can pad them with transparent or black or something), unless
      we start panning up and down and expecting to cycle around
TODO:
    * Add support for 360 degree panoramas, so it will wrap around
-->

<html>
  <head>
    <meta http-equiv="imagetoolbar" content="no" />
    
    <style type="text/css">
      @import url(../styles/panojs.css);
    </style>

    <script type="text/javascript" src="../extjs/ext-core.js"></script>    
    
    <script type="text/javascript" src="../panojslg/utils.js"></script>    
    <script type="text/javascript" src="../panojslg/PanoJSLG.js"></script>
    <script type="text/javascript" src="../panojslg/controls.js"></script>
    <script type="text/javascript" src="../panojslg/pyramid_imgcnv.js"></script>
    <script type="text/javascript" src="../panojslg/control_thumbnail.js"></script>
    <script type="text/javascript" src="../panojslg/control_info.js"></script>
    <script type="text/javascript" src="../panojslg/control_svg.js"></script>

<style type="text/css">

body {
  font-family: sans-serif;
  margin: 0;
  padding: 10px;
  color: #000000;
  background-color: #FFFFFF;
  font-size: 0.7em;
}

div.fullscreen{
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

</style> 
                
<script type="text/javascript">
// <![CDATA[

PanoJSLG.MSG_BEYOND_MIN_ZOOM = null;
PanoJSLG.MSG_BEYOND_MAX_ZOOM = null;
PanoJSLG.INITIAL_PAN = { 'x' : 1, 'y' : .5 };
var viewer1 = null;

function createViewer( viewer, dom_id, url, prefix, w, h ) {
    if (viewer) return;
  
    var MY_URL      = url;
    var MY_PREFIX   = prefix;
    var MY_TILESIZE = 128;
    var MY_WIDTH    = w;
    var MY_HEIGHT   = h;
    var MY_MAXZOOM  = 4;
//    var myPyramid = new ImgcnvPyramid( MY_WIDTH, MY_HEIGHT, MY_TILESIZE);

    PanoJSLG.TILE_BASE_URI = 'images';
    PanoJSLG.TILE_PREFIX = 'test-';

    PanoJSLG.CREATE_CONTROLS = false;
    PanoJSLG.CREATE_INFO_CONTROLS = false;
    PanoJSLG.CREATE_OSD_CONTROLS = false;
    PanoJSLG.CREATE_THUMBNAIL_CONTROLS = false;
    
    var myProvider = new PanoJSLG.TileUrlProvider('','','');
    myProvider.assembleUrl = function(xIndex, yIndex, zoom) {
        return MY_URL + '/' + MY_PREFIX + myPyramid.tile_filename( zoom, xIndex, yIndex );
    }    
    
    viewer = new PanoJSLG(dom_id, {
//        tileUrlProvider : undefined,
        //tileUrlProvider : myProvider,
        tileSize        : MY_TILESIZE,
        maxZoom         : MY_MAXZOOM,
        imageWidth      : MY_WIDTH,
        imageHeight     : MY_HEIGHT,
        blankTile       : 'images/blank.gif',
        loadingTile     : 'images/progress.gif'
    });

    Ext.EventManager.addListener( window, 'resize', callback(viewer, viewer.resize) );
    viewer.init();
    viewer.zoom(2);

    var i = 0
    var moveViewer = function() {
        // XXX HACK -- make this support 360 degree motion
        i++;
        if (i > MY_WIDTH) {
            i = 0
            viewer.moveViewerBy({ x: MY_WIDTH, y: 0})
        }
        viewer.moveViewerBy({ x: -1, y: 0 })
        setTimeout(moveViewer, 20)
    }

    setTimeout(moveViewer, 20)
};

function initViewers() {
  createViewer( viewer1, 'viewer1', 'images/', 'test', 2000,  2000 );
}
  
Ext.onReady(initViewers);




// ]]>
</script>

</head>
<body>
  <div class="fullscreen">
      <div id="viewer1" class="viewer" style="width: 100%; height: 100%;" ></div>
  </div>
</body>
</html>
